<div class="row">
  <h3>Reports</h3>
</div>

<div class="row">
  <app-chip [arrayRoutes]="['../workspace']" [materializeIcon]="'dashboard'"
            [label]="'Draft'" [value]="draft.name"></app-chip>
</div>

<div class="row">
  <div class="input-field col s12">
    <select id="report-type" (change)="changeSelectValue($event)">
      <option value="" disabled selected>Choose a report type</option>
      <option value="1" *ngIf="enableSuggestedThreats()">Suggested threats</option>
      <option value="2" *ngIf="enableClassifiedThreats()">Classified threats</option>
      <option value="3" *ngIf="enableDefinedControlActions()">Defined control actions</option>
    </select>
    <label>Report type</label>
  </div>
</div>

<div class="report-page" *ngIf="reportType !== undefined">
  <div class="row">
    <div class="col s12">
      <hr class="section-separator">
      <h5>Draft Details</h5>

      <div>
        <label>Name</label>
        <div>{{ draft.name }}</div>
      </div>

      <div>
        <label>Description</label>
        <div>{{ draft.description }}</div>
      </div>
    </div>
  </div>

  <div class="row" [ngSwitch]="reportType">
    <div class="col s12">
      <!-- suggested threats -->
      <div *ngSwitchCase="1">
        <hr class="section-separator">
        <h5>Suggested threats</h5>

        <table class="highlight">
          <thead>
          <tr>
            <th>Threat</th>
            <th>Type</th>
          </tr>
          </thead>

          <tbody>
          <tr *ngFor="let threat of threatList; let index = index">
            <td>{{ threat.label }}</td>
            <td>{{ threat.type }}</td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Classified threats -->
      <div *ngSwitchCase="2">
        <hr class="section-separator">
        <h5>Classified threats</h5>

        <div class="threat-section" *ngFor="let threat of threatList; let i = index">
          <label>Threat {{ i + 1 }}</label>
          <div>{{ threat.label }}</div>

          <label>Type</label>
          <div>{{ threat.type }}</div>

          <label>Classification</label>
          <div class="label-title">Impact: {{ threatValuesObj[threat.key]['impact'] }}</div>
          <div class="label-title">Urgency: {{ threatValuesObj[threat.key]['urgency'] }}</div>
          <div class="label-title">Trend: {{ threatValuesObj[threat.key]['trend'] }}</div>
        </div>
      </div>

      <!-- Defined control actions -->
      <div *ngSwitchCase="3">
        <hr class="section-separator">
        <h5>Defined control actions</h5>

        <div class="threat-section" *ngFor="let threat of threatList; let i = index">
          <label>Threat {{ i + 1 }}</label>
          <div>{{ threat.label }}</div>

          <label>Defined control actions</label>
          <div *ngIf="getControlActionList(threat).length !== 0">
            <div *ngFor="let controlAction of getControlActionList(threat)">
              <span class="label-title">{{ controlAction.label }}.</span>

              <div class="related-threats" *ngIf="actionRelatedThreatsObj[controlAction.key] !== undefined">
                <label>Threats generated by adopting this control action</label>
                <div *ngFor="let threat of getRelatedThreatList(actionRelatedThreatsObj[controlAction.key])">
                  <span class="related-threat">- {{ threat }}.</span>
                </div>
              </div>
            </div>

          </div>

          <div *ngIf="getControlActionList(threat).length === 0">
            No control actions defined for this threat.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
